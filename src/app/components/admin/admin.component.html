<div class="container mt-3">
  <h2>Gestion des Factures</h2>
<button routerLink="/dashboard">création</button>
  <!-- Formulaire -->
 

  <!-- Tableau -->
  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th>Numero</th>
        <th>Date</th>
        <th>Fournisseur</th>
        <th>Article</th>
        <th>Quantité</th>
        <th>Montant</th>
        <th>Total</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let facture of factures">
        <td>{{ facture.numero }}</td>
        <td>{{ facture.date | date: 'yyyy-MM-dd' }}</td>
        <td>{{ facture.fournisseur.nom }}</td>
        <td>{{ facture.article?.libelle}}</td>
        <td>{{ facture.quantity}}</td>
        <td>{{ facture.montant |currency:"TND"}}</td>
        <td>{{ facture.montantTotal|currency:"TND" }}</td>
        <td>
          
         
            <button (click)="goToFacture(facture.id!)">modifier</button>
          <button class="btn btn-sm btn-success" (click)="validateFacture(facture.id!)">
            Valider
          </button>
          <button class="btn btn-sm btn-secondary" (click)="printFacture(facture)">
            Imprimer
          </button>
           <button class="btn btn-sm btn-danger" (click)="deleteFacture(facture.id!)">
            Supprimer
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>


<div class="fournisseur-list-container">
  <h2>Fournisseurs</h2>
  
  <div class="search-section">
    <form (ngSubmit)="onSearchSubmit()">
      <input formControlName="search" placeholder="Rechercher fournisseur...">
      <button type="submit">Rechercher</button>
    </form>
    
    <div class="autocomplete-results" *ngIf="fournisseurForm.get('search')?.value">
      <div *ngFor="let fournisseur of filteredFournisseurs | async" 
           (click)="selectFournisseur(fournisseur)"
           class="autocomplete-item">
        {{fournisseur.nom}} ({{fournisseur.code}})
      </div>
    </div>
  </div>
  
  <form [formGroup]="fournisseurForm" (ngSubmit)="onFournisseurSubmit()" class="fournisseur-form">
    <div class="form-row">
      <div class="form-group">
        <label for="code">Code</label>
        <input type="text" id="code" formControlName="code">
        <div *ngIf="fournisseurForm.get('code')?.errors?.['required'] && fournisseurForm.get('code')?.touched" class="error">
          Code is required
        </div>
      </div>
      
      <div class="form-group">
        <label for="nom">Nom</label>
        <input type="text" id="nom" formControlName="nom">
        <div *ngIf="fournisseurForm.get('nom')?.errors?.['required'] && fournisseurForm.get('nom')?.touched" class="error">
          Nom is required
        </div>
      </div>
    </div>
    
    <div class="form-group">
      <label for="adresse">Adresse</label>
      <input type="text" id="adresse" formControlName="adresse">
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" formControlName="email">
        <div *ngIf="fournisseurForm.get('email')?.errors?.['email'] && fournisseurForm.get('email')?.touched" class="error">
          Email invalide
        </div>
      </div>
      
      <div class="form-group">
        <label for="tel">Téléphone</label>
        <input type="text" id="tel" formControlName="tel">
      </div>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label for="firstName">Prénom</label>
        <input type="text" id="firstName" formControlName="firstName">
      </div>
      
      <div class="form-group">
        <label for="lastName">Nom</label>
        <input type="text" id="lastName" formControlName="lastName">
      </div>
    </div>
    
    <button type="submit" [disabled]="!fournisseurForm.valid">{{ isEditing ? 'Modifier Fournisseur' : 'Ajouter Fournisseur' }}</button>
    <button type="button" (click)="resetForm()" *ngIf="isEditing">Annuler</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>Code</th>
        <th>Nom</th>
        <th>Email</th>
        <th>Téléphone</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let fournisseur of fournisseurs">
        <td>{{fournisseur.code}}</td>
        <td>{{fournisseur.nom}}</td>
        <td>{{fournisseur.email}}</td>
        <td>{{fournisseur.tel}}</td>
        <td>
          <button (click)="editFournisseur(fournisseur)">Modifier</button>
          <button (click)="deleteFournisseur(fournisseur.id)">Supprimer</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
<div class="article-list-container">
  <h3>Articles</h3>
  
  <div class="create-form">
    <h4>Add New Article</h4>
    <form (ngSubmit)="createArticle()">
      <input [(ngModel)]="newArticle.code" name="code" placeholder="Code" required>
      <input [(ngModel)]="newArticle.libelle" name="libelle" placeholder="Libelle" required>
      <input type="number" [(ngModel)]="newArticle.prix" name="prix" placeholder="Price" required>
      <input type="number" [(ngModel)]="newArticle.tva" name="tva" placeholder="TVA" required>
      <button type="submit">Add</button>
    </form>
  </div>

  <div *ngIf="editingArticle" class="edit-form">
    <h4>Edit Article</h4>
    <form (ngSubmit)="updateArticle()">
      <input [(ngModel)]="editingArticle.code" name="code" required>
      <input [(ngModel)]="editingArticle.libelle" name="libelle" required>
      <input type="number" [(ngModel)]="editingArticle.prix" name="prix" required>
      <input type="number" [(ngModel)]="editingArticle.tva" name="tva" required>
      <button type="submit">Update</button>
      <button type="button" (click)="editingArticle = null">Cancel</button>
    </form>
  </div>

  <table>
    <thead>
      <tr>
        <th>Code</th>
        <th>Libelle</th>
        <th>Price</th>
        <th>TVA</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let article of articles">
        <td>{{article.code}}</td>
        <td>{{article.libelle}}</td>
        <td>{{article.prix | currency:'TND'}}</td>
        <td>{{article.tva}}%</td>
        
       
        <td>
          <button (click)="editArticle(article)">Edit</button>
          <button (click)="deleteArticle(article.id)">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>


</div>